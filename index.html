<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ›¼è°· 6 å¤© 5 å¤œè¦ªå­å°Šäº«ä¹‹æ—…</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F3F4F6;
            -webkit-tap-highlight-color: transparent;
        }
        /* éš±è— Scrollbar ä½†ä¿æŒåŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* æ¨¡æ“¬ iOS å½ˆæ€§æ»¾å‹• */
        .scrolling-touch {
            -webkit-overflow-scrolling: touch;
        }
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF8C00', // æ³°åœ‹æ©˜
                        secondary: '#4B0082', // çš‡å®¤ç´«
                        bg: '#F3F4F6'
                    }
                }
            }
        }
    </script>
</head>
<body class="h-screen overflow-hidden text-gray-800">

    <div id="app" class="h-full flex flex-col relative max-w-md mx-auto bg-white shadow-2xl h-screen">
        
        <!-- Header -->
        <header class="bg-white px-5 pt-10 pb-4 shadow-sm z-10 flex justify-between items-center sticky top-0">
            <div>
                <h1 class="text-2xl font-bold text-gray-900 tracking-tight">
                    <span class="text-primary">Sawadee</span> Bangkok ğŸ‡¹ğŸ‡­
                </h1>
                <p class="text-xs text-gray-500 font-medium mt-1">è¦ªå­å°Šäº«ä¹‹æ—… (12/26 - 12/31)</p>
            </div>
            <button @click="showSettings = true" class="text-gray-400 hover:text-primary transition">
                <i class="fa-solid fa-gear text-lg"></i>
            </button>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto no-scrollbar scrolling-touch bg-gray-50 p-4 pb-24 relative">
            
            <!-- VIEW: ITINERARY (è¡Œç¨‹) -->
            <div v-if="currentTab === 'itinerary'" class="space-y-4">
                
                <!-- Day Selector -->
                <div class="flex space-x-3 overflow-x-auto no-scrollbar pb-2">
                    <button 
                        v-for="(day, index) in tripDays" 
                        :key="index"
                        @click="activeDayIndex = index"
                        class="flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold transition-all transform active:scale-95 shadow-sm flex flex-col items-center min-w-[80px]"
                        :class="activeDayIndex === index ? 'bg-primary text-white shadow-md' : 'bg-white text-gray-500 border border-gray-100'"
                    >
                        <span>Day {{ index + 1 }}</span>
                        <span class="text-[10px] font-normal opacity-80">{{ day.date }}</span>
                    </button>
                    <button @click="addDay" class="flex-shrink-0 px-3 py-2 rounded-full text-sm bg-gray-200 text-gray-600">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>

                <!-- Day Title & Summary -->
                <div class="bg-orange-50 p-4 rounded-xl border border-orange-100 mb-2">
                    <h2 class="font-bold text-lg text-gray-800">{{ tripDays[activeDayIndex].title || 'è‡ªç”±æ´»å‹•' }}</h2>
                    <p class="text-xs text-gray-500 mt-1" v-if="tripDays[activeDayIndex].note">
                        <i class="fa-solid fa-circle-info mr-1 text-primary"></i>
                        {{ tripDays[activeDayIndex].note }}
                    </p>
                </div>

                <!-- Timeline List -->
                <div class="relative pl-4 space-y-6 mt-4">
                    <!-- Vertical Line -->
                    <div class="absolute left-4 top-2 bottom-2 w-0.5 bg-gray-200"></div>

                    <!-- Items -->
                    <div v-for="item in currentDayItems" :key="item.id" class="relative pl-6 group">
                        <!-- Dot -->
                        <div class="absolute left-[11px] top-1.5 w-3 h-3 bg-white border-2 border-primary rounded-full z-10 group-hover:bg-primary transition-colors"></div>
                        
                        <!-- Card -->
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 active:scale-[0.99] transition-transform">
                            <div class="flex justify-between items-start mb-2">
                                <div class="font-bold text-primary text-lg">{{ item.time }}</div>
                                <div class="flex space-x-1">
                                    <button v-if="item.thaiAddr" @click="showThaiAddress(item)" class="w-8 h-8 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center hover:bg-purple-100" title="é¡¯ç¤ºæ³°æ–‡åœ°å€çµ¦å¸æ©Ÿçœ‹">
                                        <i class="fa-solid fa-language text-sm"></i>
                                    </button>
                                    <button @click="openMap(item.location)" class="w-8 h-8 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center hover:bg-blue-100">
                                        <i class="fa-solid fa-location-arrow text-sm"></i>
                                    </button>
                                    <button @click="editItem(item)" class="w-8 h-8 rounded-full bg-gray-50 text-gray-400 flex items-center justify-center hover:text-gray-600">
                                        <i class="fa-solid fa-pen text-xs"></i>
                                    </button>
                                </div>
                            </div>
                            <h3 class="font-bold text-gray-800 text-lg leading-tight mb-1">{{ item.title }}</h3>
                            
                            <!-- Location -->
                            <div class="flex items-center text-gray-500 text-sm mb-2">
                                <i class="fa-solid fa-map-pin mr-1.5 text-xs text-gray-400 w-4 text-center"></i>
                                <span class="truncate">{{ item.location }}</span>
                            </div>

                            <!-- Transport/Details Badge -->
                            <div class="flex flex-wrap gap-2 mt-2">
                                <span v-if="item.transport" class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-600">
                                    <i class="fa-solid fa-van-shuttle mr-1"></i> {{ item.transport }}
                                </span>
                                <span v-if="item.tags" v-for="tag in item.tags" :key="tag" class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-orange-50 text-orange-600">
                                    {{ tag }}
                                </span>
                            </div>

                            <!-- Description -->
                            <p v-if="item.desc" class="text-sm text-gray-500 mt-3 border-t pt-2 border-gray-50 leading-relaxed">
                                {{ item.desc }}
                            </p>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div v-if="currentDayItems.length === 0" class="text-center py-10 text-gray-400">
                        <i class="fa-regular fa-calendar-xmark text-4xl mb-3 opacity-30"></i>
                        <p>é€™å¤©é‚„æ²’æœ‰è¡Œç¨‹<br>é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ–°å¢</p>
                    </div>
                </div>
            </div>

            <!-- VIEW: EXPENSE (åˆ†å¸³) -->
            <div v-if="currentTab === 'expense'" class="space-y-6">
                
                <!-- NEW: Currency Calculator Card -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-800 flex items-center gap-2">
                            <i class="fa-solid fa-money-bill-transfer text-green-500"></i> 
                            åŒ¯ç‡è¨ˆç®—æ©Ÿ
                        </h3>
                        <div class="flex items-center gap-2 text-xs bg-gray-50 px-2 py-1 rounded-lg">
                            <span class="text-gray-400">åŒ¯ç‡:</span>
                            <input type="number" v-model.number="currentRate" @input="updateFromHKD" class="w-12 bg-transparent font-bold text-gray-700 text-right outline-none border-b border-gray-300 focus:border-primary" step="0.01">
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <div class="flex-1">
                            <label class="block text-xs font-bold text-gray-400 mb-1">æ³°éŠ– (THB)</label>
                            <div class="relative">
                                <input type="number" v-model.number="calcTHB" @input="updateFromTHB" class="w-full bg-gray-50 rounded-xl px-3 py-2 text-lg font-bold text-gray-800 outline-none focus:ring-2 focus:ring-primary focus:bg-white transition text-center" placeholder="0">
                            </div>
                        </div>
                        <div class="text-gray-300 pt-5">
                            <i class="fa-solid fa-right-left"></i>
                        </div>
                        <div class="flex-1">
                            <label class="block text-xs font-bold text-gray-400 mb-1">æ¸¯å¹£ (HKD)</label>
                            <div class="relative">
                                <input type="number" v-model.number="calcHKD" @input="updateFromHKD" class="w-full bg-gray-50 rounded-xl px-3 py-2 text-lg font-bold text-gray-800 outline-none focus:ring-2 focus:ring-primary focus:bg-white transition text-center" placeholder="0">
                            </div>
                        </div>
                    </div>
                    <p class="text-[10px] text-gray-400 text-center mt-2">è¼¸å…¥ä»»ä¸€æ¬„ä½è‡ªå‹•æ›ç®—ï¼Œé è¨­åŒ¯ç‡ 4.4</p>
                </div>

                <!-- Overview Card -->
                <div class="bg-gradient-to-r from-secondary to-purple-600 rounded-2xl p-6 text-white shadow-lg relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-32 h-32 bg-white opacity-5 rounded-full -mr-10 -mt-10 blur-2xl"></div>
                    <div class="relative z-10">
                        <div class="text-purple-200 text-sm font-medium mb-1">ç¸½æ”¯å‡º (Total)</div>
                        <div class="text-4xl font-bold tracking-tight">à¸¿ {{ totalExpense.toLocaleString() }}</div>
                        <div class="mt-4 flex space-x-2 overflow-x-auto no-scrollbar">
                            <div v-for="(person, idx) in members" :key="idx" class="bg-white/20 px-3 py-1 rounded-lg text-xs backdrop-blur-sm whitespace-nowrap">
                                {{ person }}: à¸¿ {{ getPaidAmount(person).toLocaleString() }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="grid grid-cols-2 gap-3">
                    <button @click="showSettlementModal = true" class="bg-white border border-purple-100 text-secondary py-3 rounded-xl font-bold shadow-sm hover:bg-purple-50 transition flex items-center justify-center gap-2">
                        <i class="fa-solid fa-calculator"></i> çµç®—å ±è¡¨
                    </button>
                    <button @click="openExpenseModal()" class="bg-secondary text-white py-3 rounded-xl font-bold shadow-md shadow-purple-200 active:scale-95 transition flex items-center justify-center gap-2">
                        <i class="fa-solid fa-plus"></i> æ–°å¢æ¶ˆè²»
                    </button>
                </div>

                <!-- Expense List -->
                <div>
                    <h3 class="font-bold text-gray-700 mb-3 px-1">æœ€è¿‘æ¶ˆè²»è¨˜éŒ„</h3>
                    <div class="space-y-3">
                        <div v-for="exp in expenses" :key="exp.id" class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center border border-gray-50">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-purple-50 text-secondary flex items-center justify-center font-bold text-xs">
                                    {{ exp.payer.charAt(0) }}
                                </div>
                                <div>
                                    <div class="font-bold text-gray-800">{{ exp.title }}</div>
                                    <div class="text-xs text-gray-500">{{ exp.payer }} å…ˆä»˜</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-gray-900">à¸¿{{ exp.amount }}</div>
                                <button @click="deleteExpense(exp.id)" class="text-xs text-red-300 hover:text-red-500 mt-1">åˆªé™¤</button>
                            </div>
                        </div>
                        <div v-if="expenses.length === 0" class="text-center py-8 text-gray-400 text-sm">
                            å°šç„¡æ¶ˆè²»è¨˜éŒ„
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- Floating Action Button (Only for Itinerary) -->
        <button 
            v-if="currentTab === 'itinerary'"
            @click="openItineraryModal()"
            class="absolute bottom-24 right-5 w-14 h-14 bg-primary text-white rounded-full shadow-lg shadow-orange-200 flex items-center justify-center text-2xl active:scale-90 transition transform z-20"
        >
            <i class="fa-solid fa-plus"></i>
        </button>

        <!-- Bottom Navigation -->
        <nav class="bg-white border-t border-gray-100 flex justify-around items-center px-2 py-3 pb-safe z-30">
            <button @click="currentTab = 'itinerary'" class="flex-1 flex flex-col items-center gap-1 p-2 rounded-xl transition" :class="currentTab === 'itinerary' ? 'text-primary' : 'text-gray-400'">
                <i class="fa-solid fa-map-location-dot text-xl"></i>
                <span class="text-xs font-medium">è¡Œç¨‹</span>
            </button>
            <button @click="currentTab = 'expense'" class="flex-1 flex flex-col items-center gap-1 p-2 rounded-xl transition" :class="currentTab === 'expense' ? 'text-secondary' : 'text-gray-400'">
                <i class="fa-solid fa-coins text-xl"></i>
                <span class="text-xs font-medium">åˆ†å¸³/åŒ¯ç‡</span>
            </button>
        </nav>


        <!-- MODAL: ADD/EDIT ITINERARY -->
        <div v-if="showItineraryModal" class="fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center backdrop-blur-sm p-4">
            <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl transform transition-all animate-slide-up">
                <h3 class="text-xl font-bold mb-4">{{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h3>
                
                <div class="space-y-4 max-h-[60vh] overflow-y-auto no-scrollbar">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">æ™‚é–“</label>
                        <input v-model="formItinerary.time" type="time" class="w-full bg-gray-100 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">æ´»å‹•åç¨±</label>
                        <input v-model="formItinerary.title" type="text" placeholder="ä¾‹ï¼šå»æ´½åœ–æ´½é€›è¡—" class="w-full bg-gray-100 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">åœ°é» (Google Maps)</label>
                        <input v-model="formItinerary.location" type="text" placeholder="ä¾‹ï¼šChatuchak Market" class="w-full bg-gray-100 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">äº¤é€šæ–¹å¼</label>
                        <input v-model="formItinerary.transport" type="text" placeholder="ä¾‹ï¼šåŒ…è»Šã€Grab" class="w-full bg-gray-100 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">å‚™è¨» / æ³°æ–‡åœ°å€</label>
                        <textarea v-model="formItinerary.desc" rows="3" class="w-full bg-gray-100 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-primary text-sm"></textarea>
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <button @click="showItineraryModal = false" class="flex-1 py-3 rounded-xl bg-gray-100 font-bold text-gray-600">å–æ¶ˆ</button>
                    <button v-if="isEditing" @click="deleteItinerary" class="flex-none px-4 py-3 rounded-xl bg-red-50 text-red-500 font-bold"><i class="fa-solid fa-trash"></i></button>
                    <button @click="saveItinerary" class="flex-1 py-3 rounded-xl bg-primary text-white font-bold shadow-lg shadow-orange-100">å„²å­˜</button>
                </div>
            </div>
        </div>

        <!-- MODAL: THAI ADDRESS -->
        <div v-if="showThaiAddrModal" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-6 backdrop-blur-sm">
            <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl text-center">
                <div class="w-16 h-16 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                    <i class="fa-solid fa-taxi"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-500 mb-2">è«‹å¸æ©Ÿå»é€™è£¡</h3>
                <h2 class="text-2xl font-bold text-gray-900 mb-6 leading-relaxed select-all">{{ thaiAddrContent }}</h2>
                <button @click="showThaiAddrModal = false" class="w-full py-3 rounded-xl bg-gray-800 text-white font-bold">é—œé–‰</button>
            </div>
        </div>

        <!-- MODAL: ADD EXPENSE -->
        <div v-if="showExpenseModal" class="fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center backdrop-blur-sm p-4">
            <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl transform transition-all animate-slide-up">
                <h3 class="text-xl font-bold mb-4">è¨˜ä¸€ç­†</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">é …ç›®</label>
                        <input v-model="formExpense.title" type="text" placeholder="ä¾‹ï¼šåˆé¤ã€Grab" class="w-full bg-gray-100 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-secondary">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">é‡‘é¡ (THB)</label>
                        <input v-model.number="formExpense.amount" type="number" placeholder="0" class="w-full bg-gray-100 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-secondary text-lg font-mono">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">èª°å…ˆä»˜çš„ï¼Ÿ</label>
                        <div class="flex flex-wrap gap-2">
                            <button 
                                v-for="m in members" 
                                :key="m"
                                @click="formExpense.payer = m"
                                class="px-4 py-2 rounded-lg text-sm font-bold border transition"
                                :class="formExpense.payer === m ? 'bg-secondary text-white border-secondary' : 'bg-white text-gray-500 border-gray-200'"
                            >
                                {{ m }}
                            </button>
                        </div>
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <button @click="showExpenseModal = false" class="flex-1 py-3 rounded-xl bg-gray-100 font-bold text-gray-600">å–æ¶ˆ</button>
                    <button @click="saveExpense" class="flex-1 py-3 rounded-xl bg-secondary text-white font-bold shadow-lg shadow-purple-200">æ–°å¢</button>
                </div>
            </div>
        </div>

        <!-- MODAL: SETTLEMENT REPORT -->
        <div v-if="showSettlementModal" class="fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center backdrop-blur-sm p-4">
            <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">çµç®—å»ºè­°</h3>
                    <button @click="showSettlementModal = false" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i class="fa-solid fa-xmark"></i></button>
                </div>

                <div class="bg-blue-50 p-4 rounded-xl text-sm text-blue-800 mb-4">
                    <p class="font-bold mb-1">ç¸½èŠ±è²»: à¸¿{{ totalExpense }}</p>
                    <p>å¹³å‡æ¯äºº: à¸¿{{ (totalExpense / members.length).toFixed(1) }}</p>
                </div>

                <div v-if="settlements.length > 0" class="space-y-3">
                    <div v-for="(s, idx) in settlements" :key="idx" class="flex items-center justify-between p-3 border border-gray-100 rounded-xl shadow-sm">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-red-500">{{ s.from }}</span>
                            <i class="fa-solid fa-arrow-right text-gray-300 text-xs"></i>
                            <span class="font-bold text-green-500">{{ s.to }}</span>
                        </div>
                        <span class="font-mono font-bold bg-gray-100 px-2 py-1 rounded">à¸¿{{ Math.round(s.amount) }}</span>
                    </div>
                    <p class="text-xs text-gray-400 text-center mt-4">å·²ä½¿ç”¨æœ€å°è½‰å¸³æ¬¡æ•¸æ¼”ç®—æ³•å„ªåŒ–</p>
                </div>
                <div v-else class="text-center py-6 text-green-600 font-bold">
                    <i class="fa-solid fa-check-circle text-3xl mb-2"></i>
                    <p>å¸³ç›®å·²å¹³è¡¡ï¼Œä¸éœ€è¦è½‰å¸³ï¼</p>
                </div>
            </div>
        </div>

        <!-- MODAL: SETTINGS (MEMBERS) -->
        <div v-if="showSettings" class="fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center backdrop-blur-sm p-4">
            <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl">
                <h3 class="text-xl font-bold mb-4">è¨­å®š</h3>
                
                <div class="mb-4">
                    <label class="block text-xs font-bold text-gray-500 mb-2">æ—…ä¼´ç®¡ç†</label>
                    <div class="flex gap-2 mb-2">
                        <input v-model="newMemberName" type="text" placeholder="è¼¸å…¥åå­—" class="flex-1 bg-gray-100 rounded-xl px-4 py-2 outline-none">
                        <button @click="addMember" class="bg-gray-800 text-white px-4 rounded-xl font-bold">+</button>
                    </div>
                    <div class="flex flex-wrap gap-2 mt-3">
                        <div v-for="(m, idx) in members" :key="idx" class="bg-gray-100 px-3 py-1 rounded-full text-sm flex items-center gap-2">
                            {{ m }}
                            <button @click="removeMember(idx)" class="text-gray-400 hover:text-red-500" v-if="members.length > 1">Ã—</button>
                        </div>
                    </div>
                </div>

                <div class="pt-4 border-t">
                    <button @click="resetAllData" class="w-full py-3 rounded-xl border border-red-200 text-red-500 font-bold mb-2">é‚„åŸé è¨­è¡Œç¨‹ (é‡ç½®)</button>
                    <button @click="showSettings = false" class="w-full py-3 rounded-xl bg-gray-800 text-white font-bold">å®Œæˆ</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        const defaultItinerary = [
            { 
                id: 1, 
                date: '12/26 (äº”)',
                title: 'å•Ÿç¨‹æ›¼è°·ãƒ»åˆè¦‹æ³°å‘³', 
                note: 'å»ºè­°ï¼šæ©Ÿå ´åˆ°é£¯åº—åŒ…è»Šæœ€èˆ’é©',
                items: [
                    { id: 101, time: '12:05', title: 'æŠµé” BKK æ©Ÿå ´', location: 'Suvarnabhumi Airport', desc: 'é ˜å®Œè¡Œæå¾Œï¼Œå‰å¾€é å®šå¥½çš„å°ˆè»Šæ¥æ©Ÿé»é›†åˆã€‚', transport: 'åŒ…è»Š/æ¥é€' },
                    { id: 102, time: '14:00', title: 'é£¯åº— Check-in & ä¼‘æ¯', location: 'Centre Point Hotel Sukhumvit 10', thaiAddr: '39 à¸‹à¸­à¸¢ à¸ªà¸¸à¸‚à¸¸à¸¡à¸§à¸´à¸— 10 à¹à¸‚à¸§à¸‡à¸„à¸¥à¸­à¸‡à¹€à¸•à¸¢', desc: 'è®“é•·è¼©å°å­©å…ˆä¼‘æ¯ï¼Œæ•´ç†è¡Œæã€‚', tags: ['ä½å®¿'] },
                    { id: 103, time: '15:30', title: 'Chef Ple èŠ’æœç³¯ç±³é£¯', location: 'Chef Ple Thai Mango Sticky Rice', desc: 'åœ¨ Times Square Building æ—ã€‚å¯å¤–å¸¶å›é£¯åº—åƒã€‚', transport: 'æ­¥è¡Œ/TukTuk' },
                    { id: 104, time: '17:30', title: 'EmSphere å•†å ´æ™šé¤', location: 'EmSphere', thaiAddr: '628 à¸–à¸™à¸™à¸ªà¸¸à¸‚à¸¸à¸¡à¸§à¸´à¸— à¹à¸‚à¸§à¸‡à¸„à¸¥à¸­à¸‡à¸•à¸±à¸™ à¹€à¸‚à¸•à¸„à¸¥à¸­à¸‡à¹€à¸•à¸¢', desc: 'é¤å»³ï¼šKub Kao Kub Pla (åƒé£¯åƒé­š)ã€‚ç’°å¢ƒèˆ’é©ï¼Œå£å‘³é©åˆå…¨å®¶ã€‚', transport: 'Grab/åŒ…è»Š', tags: ['æ™šé¤'] }
                ]
            },
            { 
                id: 2, 
                date: '12/27 (å…­)',
                title: 'æ³°æœç©¿è¶Šãƒ»æ²³ç•”ç››å®´', 
                note: 'é‡é»æ—¥ï¼æ³¨æ„é•·è¼©é«”åŠ›ï¼Œé„­ç‹å»Ÿæ¨“æ¢¯é™¡å³­ã€‚',
                items: [
                    { id: 201, time: '09:30', title: 'é„­ç‹å»Ÿæ³°æœé«”é©—', location: 'Wat Arun', thaiAddr: '158 à¸–à¸™à¸™à¸§à¸±à¸‡à¹€à¸”à¸´à¸¡ à¹à¸‚à¸§à¸‡à¸§à¸±à¸”à¸­à¸£à¸¸à¸“ à¹€à¸‚à¸•à¸šà¸²à¸‡à¸à¸­à¸à¹ƒà¸«à¸à¹ˆ', desc: 'Vision Thai Studio æ›è£ã€‚é•·è¼©èˆ‡å¹¼ç«¥å»ºè­°åœ¨å¹³é¢åº­åœ’æ‹ç…§å³å¯ï¼Œæ³¨æ„å®‰å…¨ã€‚', transport: 'åŒ…è»Š' },
                    { id: 202, time: '12:30', title: 'ICONSIAM åˆé¤', location: 'ICONSIAM', thaiAddr: '299 à¸–à¸™à¸™à¹€à¸ˆà¸£à¸´à¸à¸™à¸„à¸£ à¹à¸‚à¸§à¸‡à¸„à¸¥à¸­à¸‡à¸•à¹‰à¸™à¹„à¸—à¸£ à¹€à¸‚à¸•à¸„à¸¥à¸­à¸‡à¸ªà¸²à¸™', desc: 'å»ºè­°è‡³é«˜æ¨“å±¤é¤å»³ï¼ˆå¦‚ Nara Thai Cuisineï¼‰ã€‚é¤å¾Œå¯é€› SookSiam å®¤å…§æ°´ä¸Šå¸‚å ´ã€‚', transport: 'åŒ…è»Š/Grab' },
                    { id: 203, time: '15:00', title: 'ä¾ç¾…ç´€å±•è¦½', location: 'ICONSIAM Jurassic World', desc: 'åœ¨å†·æ°£æˆ¿å…§é«”é©—æ²‰æµ¸å¼æé¾ä¸–ç•Œï¼Œå°æœ‹å‹çš„æœ€æ„›ã€‚', tags: ['å±•è¦½'] },
                    { id: 204, time: '17:30', title: 'Asiatique æ²³æ¿±å¤œå¸‚æ™šé¤', location: 'Asiatique The Riverfront', thaiAddr: '2194 à¸–à¸™à¸™à¹€à¸ˆà¸£à¸´à¸à¸à¸£à¸¸à¸‡ à¹à¸‚à¸§à¸‡à¸§à¸±à¸”à¸à¸£à¸°à¸¢à¸²à¹„à¸à¸£ à¹€à¸‚à¸•à¸šà¸²à¸‡à¸„à¸­à¹à¸«à¸¥à¸¡', desc: 'æ™šé¤æ¨è–¦ï¼šKo Dang Talay (æµ·é®®å€‰åº«)ã€‚ç’°å¢ƒå¯¬æ•é©åˆå¤§å®¶åº­ã€‚', transport: 'åŒ…è»Š/Grab', tags: ['æ™šé¤'] }
                ]
            },
            { 
                id: 3, 
                date: '12/28 (æ—¥)',
                title: 'é€±æœ«æ·˜å¯¶ãƒ»åœ¨åœ°é‡£è¦æ¨‚', 
                note: 'åˆ†çµ„è¡Œå‹•ï¼šé•·è¼©å¹¼ç«¥å¹å†·æ°£ï¼Œæ¡è³¼çµ„é€›å¸‚é›†ã€‚',
                items: [
                    { id: 301, time: '10:00', title: 'æ´½åœ–æ´½å¸‚é›† / Mixt å•†å ´', location: 'Mixt Chatuchak', thaiAddr: '8 Kamphaeng Phet 3 Rd, Chatuchak', desc: 'é•·è¼©å¹¼ç«¥åœ¨ Mixt å•†å ´å¹å†·æ°£ä¼‘æ¯ã€‚æ¡è³¼çµ„å»æˆ¶å¤–å¸‚é›†å°‹å¯¶ã€‚åˆé¤åœ¨å•†å ´å…§è§£æ±ºã€‚', transport: 'åŒ…è»Š/Grab' },
                    { id: 302, time: '15:30', title: 'é£¯åº—æ³³æ±  / è¶³éƒ¨æŒ‰æ‘©', location: 'Centre Point Hotel Sukhumvit 10', desc: 'åˆå¾Œé¿æš‘ã€‚å°æœ‹å‹ç©æ°´ï¼Œå¤§äººåœ¨é™„è¿‘æ‰¾æŒ‰æ‘©åº—æ”¾é¬†ã€‚', transport: 'å›é£¯åº—' },
                    { id: 303, time: '17:30', title: 'é‡£è¦é«”é©—æ™šé¤', location: 'Bor Tok Kung Charoen Nakhon 16', thaiAddr: 'à¸šà¹ˆà¸­à¸•à¸à¸à¸¸à¹‰à¸‡à¹€à¸ˆà¸£à¸´à¸à¸™à¸„à¸£ 16 (Soi Charoen Nakhon 16)', desc: 'é«”é©—åœ¨åœ°å¨›æ¨‚ï¼å»ºè­°å…ˆé»ä¸€äº›ç†±ç‚’ä»¥å…ç­‰å¤ªä¹…é¤“è‚šå­ã€‚', transport: 'åŒ…è»Š/Grab', tags: ['æ™šé¤'] }
                ]
            },
            { 
                id: 4, 
                date: '12/29 (ä¸€)',
                title: 'é‡ç”Ÿå‹•ç‰©åœ’ãƒ»è¦ªå­åŒæ¨‚', 
                note: 'å¼·çƒˆå»ºè­°ä»Šæ—¥å…¨æ—¥åŒ…è»Šï¼Œæ–¹ä¾¿ä¼‘æ¯èˆ‡ç½®ç‰©ã€‚',
                items: [
                    { id: 401, time: '08:30', title: 'Safari World é‡ç”Ÿå‹•ç‰©åœ’', location: 'Safari World', thaiAddr: '99 à¸–à¸™à¸™à¸›à¸±à¸à¸à¸²à¸­à¸´à¸™à¸—à¸£à¸² à¹à¸‚à¸§à¸‡à¸ªà¸²à¸¡à¸§à¸²à¸•à¸°à¸§à¸±à¸™à¸•à¸ à¹€à¸‚à¸•à¸„à¸¥à¸­à¸‡à¸ªà¸²à¸¡à¸§à¸²', desc: 'ä¸Šåˆæ­è»ŠéŠé‡ç”Ÿå‹•ç‰©å€ (Safari Park)ï¼Œä¸‹åˆæ­¥è¡Œæµ·æ´‹å…¬åœ’å€ (Marine Park)ã€‚å¿…å»é•·é ¸é¹¿é¤µé£Ÿäº­ã€‚', transport: 'åŒ…è»Š', tags: ['å…¨æ—¥éŠ'] },
                    { id: 402, time: '18:30', title: 'Central World æ™šé¤', location: 'Central World', thaiAddr: '999/9 à¸–à¸™à¸™à¸à¸£à¸°à¸£à¸²à¸¡à¸—à¸µà¹ˆ à¹‘ à¹à¸‚à¸§à¸‡à¸›à¸—à¸¸à¸¡à¸§à¸±à¸™', desc: 'æ™šé¤ï¼šSavoey Seafood (ä¸Šå‘³æ³°é¤é¤¨)ï¼Œ2æ¨“ Groove å€ã€‚æ¨è–¦å’–å“©èƒèŸ¹ã€‚', transport: 'åŒ…è»Šå›å¸‚å€', tags: ['æ™šé¤'] }
                ]
            },
            { 
                id: 5, 
                date: '12/30 (äºŒ)',
                title: 'ä¼´æ‰‹ç¦®ãƒ»æµ·æ´‹æ¢ç´¢ãƒ»å¤œå¸‚', 
                note: 'åˆ©ç”¨ Skywalk é€£é€šé“ç§»å‹•ï¼Œèˆ’é©æ¶¼çˆ½ã€‚',
                items: [
                    { id: 501, time: '11:00', title: 'Big C æ¡è²·ä¼´æ‰‹ç¦®', location: 'Big C Supercenter Rajdamri', thaiAddr: '97/11 à¸–à¸™à¸™à¸£à¸²à¸Šà¸”à¸³à¸£à¸´ à¹à¸‚à¸§à¸‡à¸¥à¸¸à¸¡à¸à¸´à¸™à¸µ à¹€à¸‚à¸•à¸›à¸—à¸¸à¸¡à¸§à¸±à¸™', desc: 'å°±åœ¨ Central World å°é¢ã€‚è²·å®Œå¯å¯„æ”¾æˆ–è«‹å¸æ©Ÿè¼‰å›ã€‚', transport: 'åŒ…è»Š/Grab' },
                    { id: 502, time: '13:00', title: 'åˆé¤ï¼šThong Smith èˆ¹éºµ', location: 'Central World', desc: 'ä½æ–¼ 3 æ¨“ Beacon å€ã€‚é«˜ç´šèˆ¹éºµï¼Œè¾£åº¦å¯èª¿æ•´ã€‚', tags: ['åˆé¤'] },
                    { id: 503, time: '14:30', title: 'Sea Life æ°´æ—é¤¨ / ä¸‹åˆèŒ¶', location: 'Siam Paragon', thaiAddr: '991 à¸–à¸™à¸™à¸à¸£à¸°à¸£à¸²à¸¡à¸—à¸µà¹ˆ 1 à¹à¸‚à¸§à¸‡à¸›à¸—à¸¸à¸¡à¸§à¸±à¸™', desc: 'è¦ªå­çµ„ï¼šå» B1-B2 æ°´æ—é¤¨ã€‚ä¼‘é–’çµ„ï¼šåœ¨ç™¾è²¨å–ä¸‹åˆèŒ¶ã€‚å¾ Central World èµ° Skywalk éä¾†ã€‚', transport: 'æ­¥è¡Œ Skywalk' },
                    { id: 504, time: '18:00', title: 'å–¬å¾·å¤œå¸‚æ™šé¤', location: 'Jodd Fairs Rama 9', thaiAddr: 'à¸–à¸™à¸™à¸à¸£à¸°à¸£à¸²à¸¡ 9 à¹à¸‚à¸§à¸‡à¸«à¹‰à¸§à¸¢à¸‚à¸§à¸²à¸‡', desc: 'æ™šé¤åƒç«å±±æ’éª¨ã€‚é•·è¼©è‹¥æ€•ç†±å¯å»æ—é‚Š Central Rama 9 å•†å ´ä¼‘æ¯ã€‚', transport: 'Grab/åŒ…è»Š', tags: ['æ™šé¤'] }
                ]
            },
            { 
                id: 6, 
                date: '12/31 (ä¸‰)',
                title: 'æ»¿è¼‰è€Œæ­¸ãƒ»å†æœƒæ›¼è°·', 
                note: 'æª¢æŸ¥æˆ°åˆ©å“ï¼Œæº–å‚™å‰å¾€æ©Ÿå ´ã€‚',
                items: [
                    { id: 601, time: '09:30', title: 'æ‚ é–’æ—©é¤ & æ”¶æ‹¾', location: 'Centre Point Hotel Sukhumvit 10', desc: 'äº«å—æœ€å¾Œçš„é£¯åº—æ™‚å…‰ã€‚' },
                    { id: 602, time: '11:00', title: 'å‰å¾€æ©Ÿå ´ (BKK)', location: 'Suvarnabhumi Airport', desc: 'æ­ä¹˜å°ˆè»Šé€æ©Ÿã€‚è»Šç¨‹ç´„ 45-60 åˆ†é˜ã€‚', transport: 'åŒ…è»Šé€æ©Ÿ' },
                    { id: 603, time: '13:45', title: 'èˆªç­èµ·é£› (EK384)', location: 'Suvarnabhumi Airport', desc: '13:45 BKK -> 17:40 HKG', tags: ['é£›æ©Ÿ'] }
                ]
            }
        ];

        createApp({
            setup() {
                // State
                const currentTab = ref('itinerary');
                const activeDayIndex = ref(0);
                const showItineraryModal = ref(false);
                const showExpenseModal = ref(false);
                const showSettlementModal = ref(false);
                const showSettings = ref(false);
                const showThaiAddrModal = ref(false);
                const thaiAddrContent = ref('');
                const isEditing = ref(false);
                const editingId = ref(null);

                // Calculator State
                const calcTHB = ref('');
                const calcHKD = ref('');
                const currentRate = ref(4.4); // Default THB to HKD rate

                // Data - Initial State or from LocalStorage
                // Check if user has data, otherwise load default
                const savedTrips = JSON.parse(localStorage.getItem('tripDays_v2')); // Versioning key to force update
                const tripDays = ref(savedTrips || defaultItinerary);

                const expenses = ref(JSON.parse(localStorage.getItem('expenses')) || []);
                const members = ref(JSON.parse(localStorage.getItem('members')) || ['æˆ‘', 'å®¶äººA', 'å®¶äººB']);
                const newMemberName = ref('');

                // Forms
                const formItinerary = ref({ time: '', title: '', location: '', transport: '', desc: '', thaiAddr: '' });
                const formExpense = ref({ title: '', amount: '', payer: '' });

                // Computed
                const currentDayItems = computed(() => {
                    return tripDays.value[activeDayIndex.value].items.sort((a, b) => a.time.localeCompare(b.time));
                });

                const totalExpense = computed(() => {
                    return expenses.value.reduce((sum, item) => sum + item.amount, 0);
                });

                // Algorithm to calculate settlements
                const settlements = computed(() => {
                    if (members.value.length === 0) return [];
                    const balances = {};
                    members.value.forEach(m => balances[m] = 0);

                    const splitAmount = totalExpense.value / members.value.length;

                    // Calculate net balance for each person
                    expenses.value.forEach(exp => {
                        if (balances[exp.payer] !== undefined) {
                            balances[exp.payer] += exp.amount;
                        }
                    });

                    // Subtract average from what they paid to get net position
                    let debtors = [];
                    let creditors = [];

                    for (const m in balances) {
                        const net = balances[m] - splitAmount;
                        if (net < -0.01) debtors.push({ name: m, amount: Math.abs(net) });
                        else if (net > 0.01) creditors.push({ name: m, amount: net });
                    }

                    const result = [];
                    let i = 0; // debtor index
                    let j = 0; // creditor index

                    while (i < debtors.length && j < creditors.length) {
                        const debtor = debtors[i];
                        const creditor = creditors[j];
                        
                        const amount = Math.min(debtor.amount, creditor.amount);
                        
                        if (amount > 0) {
                            result.push({ from: debtor.name, to: creditor.name, amount: amount });
                        }

                        debtor.amount -= amount;
                        creditor.amount -= amount;

                        if (debtor.amount < 0.01) i++;
                        if (creditor.amount < 0.01) j++;
                    }

                    return result;
                });

                // Calculator Methods
                const updateFromTHB = () => {
                    if (calcTHB.value === '' || calcTHB.value === null) {
                        calcHKD.value = '';
                        return;
                    }
                    // THB / Rate = HKD
                    calcHKD.value = (calcTHB.value / currentRate.value).toFixed(2);
                };

                const updateFromHKD = () => {
                    if (calcHKD.value === '' || calcHKD.value === null) {
                        calcTHB.value = '';
                        return;
                    }
                    // HKD * Rate = THB
                    calcTHB.value = (calcHKD.value * currentRate.value).toFixed(0);
                };

                // Methods
                const addDay = () => {
                    const nextDayNum = tripDays.value.length + 1;
                    tripDays.value.push({ 
                        id: Date.now(), 
                        date: `Day ${nextDayNum}`,
                        title: 'æ–°çš„ä¸€å¤©',
                        items: [] 
                    });
                    activeDayIndex.value = tripDays.value.length - 1;
                };

                const openItineraryModal = () => {
                    isEditing.value = false;
                    formItinerary.value = { time: '10:00', title: '', location: '', transport: '', desc: '', thaiAddr: '' };
                    showItineraryModal.value = true;
                };

                const editItem = (item) => {
                    isEditing.value = true;
                    editingId.value = item.id;
                    formItinerary.value = { ...item };
                    showItineraryModal.value = true;
                };

                const showThaiAddress = (item) => {
                    thaiAddrContent.value = item.thaiAddr;
                    showThaiAddrModal.value = true;
                };

                const saveItinerary = () => {
                    if (!formItinerary.value.title) return;
                    
                    if (isEditing.value) {
                        const day = tripDays.value[activeDayIndex.value];
                        const idx = day.items.findIndex(i => i.id === editingId.value);
                        if (idx !== -1) day.items[idx] = { ...formItinerary.value, id: editingId.value };
                    } else {
                        tripDays.value[activeDayIndex.value].items.push({
                            id: Date.now(),
                            ...formItinerary.value
                        });
                    }
                    showItineraryModal.value = false;
                    saveData();
                };

                const deleteItinerary = () => {
                    if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ')) {
                        const day = tripDays.value[activeDayIndex.value];
                        day.items = day.items.filter(i => i.id !== editingId.value);
                        showItineraryModal.value = false;
                        saveData();
                    }
                };

                const openMap = (loc) => {
                    if (!loc) return;
                    const query = encodeURIComponent(loc + ' Bangkok');
                    window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
                };

                // Expense Methods
                const openExpenseModal = () => {
                    formExpense.value = { title: '', amount: '', payer: members.value[0] || '' };
                    showExpenseModal.value = true;
                };

                const saveExpense = () => {
                    if (!formExpense.value.title || !formExpense.value.amount || !formExpense.value.payer) return;
                    expenses.value.unshift({
                        id: Date.now(),
                        ...formExpense.value
                    });
                    showExpenseModal.value = false;
                    saveData();
                };

                const deleteExpense = (id) => {
                    if (confirm('åˆªé™¤é€™ç­†å¸³ç›®ï¼Ÿ')) {
                        expenses.value = expenses.value.filter(e => e.id !== id);
                        saveData();
                    }
                };

                const getPaidAmount = (person) => {
                    return expenses.value
                        .filter(e => e.payer === person)
                        .reduce((sum, e) => sum + e.amount, 0);
                };

                // Settings Methods
                const addMember = () => {
                    if (newMemberName.value && !members.value.includes(newMemberName.value)) {
                        members.value.push(newMemberName.value);
                        newMemberName.value = '';
                        saveData();
                    }
                };

                const removeMember = (index) => {
                    members.value.splice(index, 1);
                    saveData();
                };

                const resetAllData = () => {
                    if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è³‡æ–™ç‚ºé è¨­è¡Œç¨‹å—ï¼Ÿæ‚¨çš„è¨˜å¸³ç´€éŒ„ä¹Ÿæœƒè¢«æ¸…ç©ºã€‚')) {
                        localStorage.removeItem('tripDays_v2');
                        localStorage.removeItem('expenses');
                        localStorage.removeItem('members');
                        location.reload();
                    }
                };

                // Persistence
                const saveData = () => {
                    localStorage.setItem('tripDays_v2', JSON.stringify(tripDays.value));
                    localStorage.setItem('expenses', JSON.stringify(expenses.value));
                    localStorage.setItem('members', JSON.stringify(members.value));
                };

                watch([tripDays, expenses, members], saveData, { deep: true });

                return {
                    currentTab,
                    tripDays,
                    activeDayIndex,
                    currentDayItems,
                    addDay,
                    
                    // Itinerary
                    showItineraryModal,
                    showThaiAddrModal,
                    thaiAddrContent,
                    formItinerary,
                    isEditing,
                    openItineraryModal,
                    editItem,
                    showThaiAddress,
                    saveItinerary,
                    deleteItinerary,
                    openMap,

                    // Expenses
                    expenses,
                    totalExpense,
                    showExpenseModal,
                    showSettlementModal,
                    formExpense,
                    settlements,
                    openExpenseModal,
                    saveExpense,
                    deleteExpense,
                    getPaidAmount,

                    // Calculator
                    calcTHB,
                    calcHKD,
                    currentRate,
                    updateFromTHB,
                    updateFromHKD,

                    // Settings
                    showSettings,
                    members,
                    newMemberName,
                    addMember,
                    removeMember,
                    resetAllData
                };
            }
        }).mount('#app');
    </script>
    <style>
        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
            animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
    </style>
</body>
</html>
